<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Hekko</title>
    <link rel="stylesheet/less" type="text/css" href="../style/style.less" />
    <script src="../js/less.min.js"></script>
    <script src="../js/jquery-3.3.1.min.js"></script>
</head>
<body>
   
    <div id="app">
       
        <div class="container">
            <h1 class="accent" title="last update: 09.10.2018" @click="debug = !debug">hekko IB</h1>
            <div v-if="debug" class="debug">
                <p>location: {{location}}</p>
                <hr>
                <p>database: {{database}}</p>
                <hr>
                <p>thread: {{thread}}</p>
                <hr>
                <p>comments: {{comments}}</p>
            </div>
        </div>

        <!-- СПИСОК ТРЕДОВ -->
        <div class="container" v-if="location == 0 && database.length > 0">
            <h2>Треды:</h2>
            <div class="threads" v-for="thread in database" v-if="thread.parent == 0" >
                <p>
                    <a :href="'#'+thread.id" class="accent" @click="load_thread(thread.id)">#{{thread.id}}: {{thread.title}} ({{count_comments(thread.id)}})</a>
                    <span class="right" @click="delete_thread(thread.id)">&#10006;</span>
                </p>
            </div>
        </div>

        <!-- ТРЕД -->
        
        <div class="container" v-if="!thread">
            <p>Такого треда не существует</p>
            <br>
            <a href="/" class="accent">Вернуться назад</a>
        </div>
        
        <div class="container" v-if="location > 0 && thread">
            <div class="thread" v-if="thread">
                <span @click="load_thread(0)">&#8592;</span>
                <a :href="thread.img" target="_blank" v-if="thread.img != 'no'"><img :src="thread.img"></a>
                <h2>{{thread.title}}</h2>
                <p>{{thread.body}}</p>
            </div>
        </div>

        <div class="container" v-if="location > 0 && comments.length > 0 && thread">
            <h2 v-if="comments.length > 0">Комментарии:</h2>
            <hr>
            <div class="comment" v-for="comment in comments">
                <p>
                    #{{comment.id}} <span class="accent">{{comment.title}}</span>: {{comment.body}} 
                    <span class="right" @click="delete_comment(comment.id, thread.id)">&#10006;</span>
                </p>
            </div>
        </div>

        <div class="container" v-if="location > 0 && thread">
            <label>Новый комментарий <span class="accent">(ctrl+enter)</span>:</label>
            <input placeholder="подпись" type="text" v-model="new_comment_title" @keyup.ctrl.enter="add_comment(thread.id)">
            <textarea placeholder="текст" v-model="new_comment_body" @keyup.ctrl.enter="add_comment(thread.id)"></textarea>
            <button @click="add_comment(thread.id)">Добавить</button>
        </div>

        <!-- НОВЫЙ ТРЕД -->
        <div class="container" v-show="location == 0">
           
            <form id="new_thread_form" action="/app/app.php" method="post" enctype="multipart/form-data">
                <input type="hidden" name="action" value="add_thread">
                <label>Новый тред form <span class="accent">(ctrl+enter)</span>:</label>
                <input placeholder="заголовок" type="text" name="title">
                <textarea placeholder="текст" name="body"></textarea>
                
                <label for="file">Картинка</label>
                <input type="file" name="img" id="file" class="inputfile">
                <label for="file" class="btn-main btn-light">Выбери файл</label>
                
                <button type="submit">Создать</button>
            </form>
        </div>
        
    </div>
    
    <script src="../js/vue.min.js"></script>
    <script src="../js/index.js"></script>
</body>
</html>


<script>
    
    var input = document.querySelectorAll( '.inputfile' )[0];
    var label	 = input.nextElementSibling;
    var labelVal = label.innerHTML;

    input.addEventListener( 'change', function( e )
    {
        var fileName = '';
        fileName = e.target.value.split( '\\' ).pop();

        if( fileName ) {
            label.innerHTML = "выбрано: " + fileName;
        }
        else {
            label.innerHTML = labelVal;
        }
    });
</script>